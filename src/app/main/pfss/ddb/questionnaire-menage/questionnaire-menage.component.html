<div class="page-layout simple fullwidth" fxLayout="column">
    <div class="header primary p-4 h-24" fxLayout="row" fxLayoutAlign="start center">
        <div fxLayout="column" fxLayoutAlign="center start">
            <div fxLayout="row" fxLayoutAlign="start center"
                style="margin-top: 0px !important; padding-top: 0px !important;">
                <mat-icon class="s-18" style="color: #0eaf3b;">home</mat-icon>
                <mat-icon class="s-18" style="color: #0eaf3b;">chevron_right</mat-icon>
                <span style="color: #0eaf3b;">Données de base</span>
                <mat-icon class="s-18" style="color: #0eaf3b;">chevron_right</mat-icon>
                <span style="color: #0eaf3b;">Questionnaire ménage</span>
            </div>
        </div>
    </div>
    <div class="content">
        <!-- debut liste questionnaires -->
        <div class="tab-content p-2">
            <div class="mat-card mat-elevation-z4  m-4">
                <div class="package-type h-44 primary-50 header primary" fxLayout="row"
                    fxLayoutAlign="space-between center">
                    <div class="p-12">
                        <span class="border-right mr-2" style="color: #0eaf3b;">Actions</span>
                        <button mat-button mat-icon-button color="fuse-navy" aria-label="Ajouter"
                        (click)="ajouterQuestionnaireMenage()" matTooltip="Ajouter" *ngIf="!this.new_item_questionnaire_menage && !this.editing_questionnaire_menage[this.index_selected_questionnaire_menage]">
                            <mat-icon matTooltip="Ajouter" class="coleur_vert">add_circle_outline</mat-icon>
                        </button>
                        <button mat-button mat-icon-button color="fuse-navy" aria-label="Modifier"
                        (click)="modifierQuestionnaireMenage()" *ngIf="item_selected_questionnaire_menage.length > 0 && !this.editing_questionnaire_menage[this.index_selected_questionnaire_menage]" matTooltip="Modifier">
                            <mat-icon matTooltip="Modifier" class="coleur_vert">edit</mat-icon>
                        </button>
                        <button mat-button mat-icon-button color="fuse-navy" aria-label="Supprimer"
                        *ngIf="item_selected_questionnaire_menage.length > 0 && !this.editing_questionnaire_menage[this.index_selected_questionnaire_menage]" (click)="supprimerQuestionnaireMenage()" matTooltip="Supprimer">
                            <mat-icon matTooltip="Supprimer" class="coleur_vert">delete</mat-icon>
                        </button>


                        <button mat-button mat-icon-button color="fuse-navy" aria-label="Enregistrer"
                        *ngIf="this.editing_questionnaire_menage[this.index_selected_questionnaire_menage]" (click)="save_in_base_questionnaire_menage(0)">
                            <mat-icon matTooltip="Enregistrer" class="coleur_vert">save</mat-icon>
                        </button>

                        <button mat-button mat-icon-button color="fuse-navy" aria-label="Annuler"
                        (click)="annulerQuestionnaireMenage()"
                        *ngIf="item_selected_questionnaire_menage.length > 0 && this.editing_questionnaire_menage[this.index_selected_questionnaire_menage]">
                            <mat-icon matTooltip="Annuler" class="coleur_vert">cancel</mat-icon>
                        </button>
                        <button mat-stroked-button style="color: #0eaf3b;">
                            <mat-icon>get_app</mat-icon>
                            EXPORTER EN EXCEL 
                        </button>
                    </div>
                    <div class="p-12">
                        <span class="border-right mr-2" style="color: #0eaf3b;">LISTE DES QUESTIONNAIRES</span>
                    </div>
                    <div class="p-12">
                        <input type="text"
                            style="padding:8px;margin:15px auto;width:100%;color:#353A48; border: 1px solid #babdc5;"
                            placeholder="Rechercher..." [(ngModel)]="search_questionnaire_menage"/>
                    </div>
                </div>
                <div>
                    <ngx-datatable class="material" [rows]="rows_questionnaire_menage | filter: search_questionnaire_menage"
                        [columnMode]="'force'" [headerHeight]="48"
                        [footerHeight]="56" [rowHeight]="'auto'" [scrollbarH]="true" [reorderable]=""
                        [selectionType]="'checkbox'" [limit]="5" [selected]="item_selected_questionnaire_menage"
                        [selectionType]="'single'" (select)="onSelectQuestionnaireMenage($event)">
                        <ngx-datatable-column name="Code" prop="code">
                            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value"
                                let-row="row">
                                <span *ngIf="!editing_questionnaire_menage[rowIndex]">{{ value }}</span>
                                <input *ngIf="editing_questionnaire_menage[rowIndex]" type="text"
                                    (change)="updateValueQuestionnaireMenage($event, 'code', rowIndex)" [value]="value" />
                            </ng-template>
                        </ngx-datatable-column>
                        <ngx-datatable-column name="Description" prop="description">
                            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value"
                                let-row="row">
                                <span *ngIf="!editing_questionnaire_menage[rowIndex]">{{ value }}</span>
                                <input *ngIf="editing_questionnaire_menage[rowIndex]" type="text"
                                    (change)="updateValueQuestionnaireMenage($event, 'description', rowIndex)" [value]="value" />
                            </ng-template>
                        </ngx-datatable-column>
                        <ngx-datatable-column name="Type de réponse" prop="liste_reponse.libelle">
                            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
                                    <span  *ngIf="!editing_questionnaire_menage[rowIndex]">{{ value }}</span>
                                    <span *ngIf="editing_questionnaire_menage[rowIndex]">
                                        <select matInput matNativeControl (selectionChange)="updateValueQuestionnaireMenage($event, 'liste_reponse', rowIndex)" [(value)]="row.liste_reponse.id">
                                            <!-- <option *ngFor="let reponse of all_reponse" [attr.selected]="row.liste_reponse.id==reponse.id ? true : null" [value]="reponse.id">
                                                {{reponse.libelle}}
                                            </option> -->
                                            <option></option>
                                            <option *ngFor="let reponse of all_reponse" [selected]="value==reponse.id ? true : null" value={{reponse.id}}>
                                                {{reponse.libelle}}
                                            </option>
                                        </select> 
                                    </span>
                            </ng-template> 
                        </ngx-datatable-column>
                    </ngx-datatable>
                </div>
            </div>
        </div>
        <!-- fin liste des questionnaires -->

        <!-- debut detail reponse -->
        <div class="tab-content p-2">
            <div class="mat-card mat-elevation-z4  m-4">
                <div class="package-type h-44 primary-50 header primary" fxLayout="row"
                    fxLayoutAlign="space-between center">
                    <div class="p-12">
                        <span class="border-right mr-2" style="color: #0eaf3b;">Actions</span>
                        <button mat-button mat-icon-button color="fuse-navy" aria-label="Ajouter"
                        (click)="ajouterDetailReponse()" matTooltip="Ajouter" *ngIf="!this.new_item_detail_reponse && !this.editing_detail_reponse[this.index_selected_detail_reponse]">
                            <mat-icon matTooltip="Ajouter" class="coleur_vert">add_circle_outline</mat-icon>
                        </button>
                        <button mat-button mat-icon-button color="fuse-navy" aria-label="Modifier"
                        (click)="modifierDetailReponse()" *ngIf="item_selected_detail_reponse.length > 0 && !this.editing_detail_reponse[this.index_selected_detail_reponse]" matTooltip="Modifier">
                            <mat-icon matTooltip="Modifier" class="coleur_vert">edit</mat-icon>
                        </button>
                        <button mat-button mat-icon-button color="fuse-navy" aria-label="Supprimer"
                        *ngIf="item_selected_detail_reponse.length > 0 && !this.editing_detail_reponse[this.index_selected_detail_reponse]" (click)="supprimerDetailReponse()" matTooltip="Supprimer">
                            <mat-icon matTooltip="Supprimer" class="coleur_vert">delete</mat-icon>
                        </button>


                        <button mat-button mat-icon-button color="fuse-navy" aria-label="Enregistrer"
                        *ngIf="this.editing_detail_reponse[this.index_selected_detail_reponse]" (click)="save_in_base_detail_reponse(0)">
                            <mat-icon matTooltip="Enregistrer" class="coleur_vert">save</mat-icon>
                        </button>

                        <button mat-button mat-icon-button color="fuse-navy" aria-label="Annuler" (click)="annulerDetailReponse()"
                         *ngIf="item_selected_detail_reponse.length > 0 && this.editing_detail_reponse[this.index_selected_detail_reponse]">
                            <mat-icon matTooltip="Annuler" class="coleur_vert">cancel</mat-icon>
                        </button>
                    </div>
                    <div class="p-12">
                        <span class="border-right mr-2" style="color: #0eaf3b;">DETAIL REPONSE</span>
                    </div>
                    <div class="p-12">
                        <input type="text"
                            style="padding:8px;margin:15px auto;width:100%;color:#353A48; border: 1px solid #babdc5;"
                            placeholder="Rechercher..." [(ngModel)]="search_detail_reponse"/>
                    </div>
                </div>
                <div>
                    <ngx-datatable class="material" [rows]="rows_detail_reponse | filter: search_detail_reponse"
                        [columnMode]="'force'" [headerHeight]="48"
                        [footerHeight]="56" [rowHeight]="'auto'" [scrollbarH]="true" [reorderable]=""
                        [selectionType]="'checkbox'" [limit]="5" [selected]="item_selected_detail_reponse"
                        [selectionType]="'single'" (select)="onSelectDetailReponse($event)">
                        <ngx-datatable-column name="Code" prop="code">
                            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value"
                                let-row="row">
                                <span *ngIf="!editing_detail_reponse[rowIndex]">{{ value }}</span>
                                <input *ngIf="editing_detail_reponse[rowIndex]" type="text"
                                    (change)="updateValueDetailReponse($event, 'code', rowIndex)" [value]="value" />
                            </ng-template>
                        </ngx-datatable-column>
                        <ngx-datatable-column name="Description" prop="description">
                            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value"
                                let-row="row">
                                <span *ngIf="!editing_detail_reponse[rowIndex]">{{ value }}</span>
                                <input *ngIf="editing_detail_reponse[rowIndex]" type="text"
                                    (change)="updateValueDetailReponse($event, 'description', rowIndex)" [value]="value" />
                            </ng-template>
                        </ngx-datatable-column>
                    </ngx-datatable>
                </div>
            </div>
        </div>
        <!-- fin detail reponse -->
    </div>
    
    <ng-template #suppression_dialog_questionnaire_menage>
        <h2 matDialogTitle>Etes-vous sûr de supprimer cet enregistrement ?</h2>
        <mat-dialog-content>

        </mat-dialog-content>
        <mat-dialog-actions align="end">
            <button mat-button matDialogClose style="color: red;" (click)="suppressionConfirmerQuestionnaireMenage()">OUI</button>
            <button mat-button matDialogClose (click)="suppressionAnnuler()" color="primary">NON</button>
        </mat-dialog-actions>
    </ng-template>
    <ng-template #suppression_dialog_detail_reponse>
        <h2 matDialogTitle>Etes-vous sûr de supprimer cet enregistrement ?</h2>
        <mat-dialog-content>

        </mat-dialog-content>
        <mat-dialog-actions align="end">
            <button mat-button matDialogClose style="color: red;" (click)="suppressionConfirmerDetailReponse()">OUI</button>
            <button mat-button matDialogClose (click)="suppressionAnnuler()" color="primary">NON</button>
        </mat-dialog-actions>
    </ng-template>
</div>
