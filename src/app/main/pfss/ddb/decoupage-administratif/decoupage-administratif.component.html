<div class="page-layout simple fullwidth" fxLayout="column">
    <div class="header primary p-4 h-24" fxLayout="row" fxLayoutAlign="start center">
        <div fxLayout="column" fxLayoutAlign="center start">
            <div fxLayout="row" fxLayoutAlign="start center"
                style="margin-top: 0px !important; padding-top: 0px !important;">
                <mat-icon class="s-18" style="color: #0eaf3b;">home</mat-icon>
                <mat-icon class="s-18" style="color: #0eaf3b;">chevron_right</mat-icon>
                <span style="color: #0eaf3b;">Données de base</span>
                <mat-icon class="s-18" style="color: #0eaf3b;">chevron_right</mat-icon>
                <span style="color: #0eaf3b;">Découpage administratif</span>
            </div>
        </div>
    </div>
    <div class="content">
        <!-- <button mat-stroked-button style="color: #0eaf3b;" class="mr-2">
            <mat-icon>get_app</mat-icon>
            EXPORTER EN EXCEL
        </button> -->
        <div class="tab-content p-2">
            <div fxLayout="row" fxLayoutAlign="space-around stretch">
                <!-- debut ile -->
                <div class="mat-card mat-elevation-z4  m-4" fxFlex="33">
                    <div class="package-type h-44 primary-50 header primary" fxLayout="row"
                        fxLayoutAlign="space-between center">
                        <div class="p-12">
                            <span class="border-right mr-2" style="color: #0eaf3b;">ILE</span>
                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Ajouter"
                                (click)="ajouterIle()" matTooltip="Ajouter"
                                *ngIf="!this.new_item_ile && !this.editing_ile[this.index_selected_ile]">
                                <mat-icon matTooltip="Ajouter" class="coleur_vert">add_circle_outline</mat-icon>
                            </button>
                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Modifier"
                                (click)="modifierIle()"
                                *ngIf="item_selected_ile.length > 0 && !this.editing_ile[this.index_selected_ile]"
                                matTooltip="Modifier">
                                <mat-icon matTooltip="Modifier" class="coleur_vert">edit</mat-icon>
                            </button>
                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Supprimer"
                                *ngIf="item_selected_ile.length > 0 && !this.editing_ile[this.index_selected_ile]"
                                (click)="supprimerIle()" matTooltip="Supprimer">
                                <mat-icon matTooltip="Supprimer" class="coleur_vert">delete</mat-icon>
                            </button>


                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Enregistrer"
                                *ngIf="this.editing_ile[this.index_selected_ile]" (click)="save_in_base_ile(0)">
                                <mat-icon matTooltip="Enregistrer" class="coleur_vert">save</mat-icon>
                            </button>

                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Annuler"
                                (click)="annulerIle()"
                                *ngIf="item_selected_ile.length > 0 && this.editing_ile[this.index_selected_ile]">
                                <mat-icon matTooltip="Annuler" class="coleur_vert">cancel</mat-icon>
                            </button>
                        </div>
                    </div>
                    <div>
                        <ngx-datatable class="material" [rows]="rows_ile" [loadingIndicator]="" [columnMode]="'force'"
                            [headerHeight]="48" [footerHeight]="56" [rowHeight]="'auto'" [scrollbarH]="true"
                            [reorderable]="" [selectionType]="'checkbox'" [limit]="5" [selected]="item_selected_ile"
                            [selectionType]="'single'" (select)="onSelectIle($event)">
                            <ngx-datatable-column name="Code" prop="Code">
                                <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value"
                                    let-row="row">
                                    <span *ngIf="!editing_ile[rowIndex]">{{ value }}</span>
                                    <input *ngIf="editing_ile[rowIndex]" type="text"
                                        (change)="updateValueIle($event, 'Code', rowIndex)" [value]="value" />
                                </ng-template>
                            </ngx-datatable-column>
                            <ngx-datatable-column name="Ile" prop="Ile">
                                <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value"
                                    let-row="row">
                                    <span *ngIf="!editing_ile[rowIndex]">{{ value }}</span>
                                    <input *ngIf="editing_ile[rowIndex]" type="text"
                                        (change)="updateValueIle($event, 'Ile', rowIndex)" [value]="value" />
                                </ng-template>
                            </ngx-datatable-column>
                        </ngx-datatable>
                    </div>
                </div>
                <!-- fin ile -->

                <!-- debut prefecture -->
                <div class="mat-card mat-elevation-z4  m-4" fxFlex="70">
                    <div class="package-type h-44 primary-50 header primary" fxLayout="row"
                        fxLayoutAlign="space-between center">
                        <div class="p-12">
                            <span class="border-right mr-2" style="color: #0eaf3b;">PREFECTURE</span>
                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Ajouter"
                            (click)="ajouterPrefecture()" matTooltip="Ajouter" *ngIf="!this.new_item_prefecture && !this.editing_prefecture[this.index_selected_prefecture] && !item_selected_ile.length == false">
                                <mat-icon matTooltip="Ajouter" class="coleur_vert">add_circle_outline</mat-icon>
                            </button>
                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Modifier"
                            (click)="modifierPrefecture()" *ngIf="item_selected_prefecture.length > 0 && !this.editing_prefecture[this.index_selected_prefecture]" matTooltip="Modifier">
                                <mat-icon matTooltip="Modifier" class="coleur_vert">edit</mat-icon>
                            </button>
                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Supprimer"
                            *ngIf="item_selected_prefecture.length > 0 && !this.editing_prefecture[this.index_selected_prefecture]" (click)="supprimerPrefecture()" matTooltip="Supprimer">
                                <mat-icon matTooltip="Supprimer" class="coleur_vert">delete</mat-icon>
                            </button>


                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Enregistrer"
                            *ngIf="this.editing_prefecture[this.index_selected_prefecture]" (click)="save_in_base_prefecture(0)">
                                <mat-icon matTooltip="Enregistrer" class="coleur_vert">save</mat-icon>
                            </button>

                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Annuler"
                            (click)="annulerPrefecture()" *ngIf="item_selected_prefecture.length > 0 && this.editing_prefecture[this.index_selected_prefecture]">
                                <mat-icon matTooltip="Annuler" class="coleur_vert">cancel</mat-icon>
                            </button>
                        </div>
                        <div class="p-12">
                            <input type="text"
                                style="padding:8px;margin:15px auto;width:100%;color:#353A48; border: 1px solid #babdc5;"
                                placeholder="Rechercher..." [(ngModel)]="search_prefecture"/>
                        </div>
                    </div>
                    <ngx-datatable class="material" [rows]="rows_prefecture | filter: search_prefecture" [loadingIndicator]=""
                        [columnMode]="'force'" [headerHeight]="48" [footerHeight]="56" [rowHeight]="'auto'"
                        [scrollbarH]="true" [reorderable]="" [selectionType]="'checkbox'" [limit]="3"
                        [selected]="item_selected_prefecture" [selectionType]="'single'"
                        (select)="onSelectPrefecture($event)">
                        <ngx-datatable-column name="Code" prop="Code">
                            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value"
                                let-row="row">
                                <span *ngIf="!editing_prefecture[rowIndex]">{{ value }}</span>
                                <input *ngIf="editing_prefecture[rowIndex]" type="text"
                                    (change)="updateValuePrefecture($event, 'Code', rowIndex)" [value]="value" />
                            </ng-template>
                        </ngx-datatable-column>
                        <ngx-datatable-column name="Region" prop="Region">
                            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value"
                                let-row="row">
                                <span *ngIf="!editing_prefecture[rowIndex]">{{ value }}</span>
                                <input *ngIf="editing_prefecture[rowIndex]" type="text"
                                    (change)="updateValuePrefecture($event, 'Region', rowIndex)" [value]="value" />
                            </ng-template>
                        </ngx-datatable-column>
                    </ngx-datatable>
                </div>
            </div>
        </div>


        <div class="tab-content p-2">
            <div fxLayout="row" fxLayoutAlign="space-around stretch">
                <!-- debut commune -->
                <div class="mat-card mat-elevation-z4  m-4" fxFlex="30">
                    <div class="package-type h-44 primary-50 header primary" fxLayout="row"
                        fxLayoutAlign="space-between center">
                        <div class="p-12">
                            <span class="border-right mr-2" style="color: #0eaf3b;">COMMUNE</span>
                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Ajouter"
                            (click)="ajouterCommune()" matTooltip="Ajouter" *ngIf="!this.new_item_commune && !this.editing_commune[this.index_selected_commune] && !item_selected_prefecture.length == false">
                                <mat-icon matTooltip="Ajouter" class="coleur_vert">add_circle_outline</mat-icon>
                            </button>
                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Modifier"
                            (click)="modifierCommune()" *ngIf="item_selected_commune.length > 0 && !this.editing_commune[this.index_selected_commune]" matTooltip="Modifier">
                                <mat-icon matTooltip="Modifier" class="coleur_vert">edit</mat-icon>
                            </button>
                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Supprimer"
                            *ngIf="item_selected_commune.length > 0 && !this.editing_commune[this.index_selected_commune]" (click)="supprimerCommune()" matTooltip="Supprimer">
                                <mat-icon matTooltip="Supprimer" class="coleur_vert">delete</mat-icon>
                            </button>

                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Enregistrer"
                            *ngIf="this.editing_commune[this.index_selected_commune]" (click)="save_in_base_commune(0)">
                                <mat-icon matTooltip="Enregistrer" class="coleur_vert">save</mat-icon>
                            </button>

                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Annuler"
                            (click)="annulerCommune()" *ngIf="item_selected_commune.length > 0 && this.editing_commune[this.index_selected_commune]">
                                <mat-icon matTooltip="Annuler" class="coleur_vert">cancel</mat-icon>
                            </button>
                        </div>
                    </div>
                    <div class="p-4">
                        <input type="text"
                            style="padding:8px;margin:15px auto;width:100%;color:#353A48; border: 1px solid #babdc5;"
                            placeholder="Rechercher..." [(ngModel)]="search_commune"/>
                    </div>
                    <ngx-datatable class="material" [rows]="rows_commune | filter: search_commune" [loadingIndicator]="" [columnMode]="'force'"
                        [headerHeight]="48" [footerHeight]="56" [rowHeight]="'auto'" [scrollbarH]="true"
                        [reorderable]="" [selectionType]="'checkbox'" [limit]="5" [selected]="item_selected_commune"
                        [selectionType]="'single'" (select)="onSelectCommune($event)">
                        <ngx-datatable-column name="Code" prop="Code">
                            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value"
                                let-row="row">
                                <span *ngIf="!editing_commune[rowIndex]">{{ value }}</span>
                                <input *ngIf="editing_commune[rowIndex]" type="text"
                                    (change)="updateValueCommune($event, 'Code', rowIndex)" [value]="value" />
                            </ng-template>
                        </ngx-datatable-column>
                        <ngx-datatable-column name="Commune" prop="Commune">
                            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value"
                                let-row="row">
                                <span *ngIf="!editing_commune[rowIndex]">{{ value }}</span>
                                <input *ngIf="editing_commune[rowIndex]" type="text"
                                    (change)="updateValueCommune($event, 'Commune', rowIndex)" [value]="value" />
                            </ng-template>
                        </ngx-datatable-column>
                    </ngx-datatable>
                </div>
                <!-- fin commune -->

                <!-- debut village -->
                <div class="mat-card mat-elevation-z4  m-4" fxFlex="72">
                    <div class="package-type h-44 primary-50 header primary" fxLayout="row"
                        fxLayoutAlign="space-between center">
                        <div class="p-12">
                            <span class="border-right mr-2" style="color: #0eaf3b;">VILLAGE</span>
                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Ajouter"
                            (click)="ajouterVillage()" matTooltip="Ajouter" *ngIf="!this.new_item_village && !this.editing_village[this.index_selected_village] && !item_selected_commune.length == false">
                                <mat-icon matTooltip="Ajouter" class="coleur_vert">add_circle_outline</mat-icon>
                            </button>
                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Modifier"
                            (click)="modifierVillage()" *ngIf="item_selected_village.length > 0 && !this.editing_village[this.index_selected_village]" matTooltip="Modifier">
                                <mat-icon matTooltip="Modifier" class="coleur_vert">edit</mat-icon>
                            </button>
                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Supprimer"
                            *ngIf="item_selected_village.length > 0 && !this.editing_village[this.index_selected_village]" (click)="supprimerVillage()" matTooltip="Supprimer">
                                <mat-icon matTooltip="Supprimer" class="coleur_vert">delete</mat-icon>
                            </button>
                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Enregistrer"
                            *ngIf="this.editing_village[this.index_selected_village]" (click)="save_in_base_village(0)">
                                <mat-icon matTooltip="Enregistrer" class="coleur_vert">save</mat-icon>
                            </button>
                            <button mat-button mat-icon-button color="fuse-navy" aria-label="Annuler"
                            (click)="annulerVillage()" *ngIf="item_selected_village.length > 0 && this.editing_village[this.index_selected_village]">
                                <mat-icon matTooltip="Annuler" class="coleur_vert">cancel</mat-icon>
                            </button>
                        </div>
                    </div>
                    <div class="p-4">
                        <input type="text"
                            style="padding:8px;margin:15px auto;width:100%;color:#353A48; border: 1px solid #babdc5;"
                            placeholder="Rechercher..." [(ngModel)]="search_village"/>
                    </div>
                    <ngx-datatable class="material" [rows]="rows_village | filter: search_village" [loadingIndicator]="" [columnMode]="'force'"
                        [headerHeight]="48" [footerHeight]="56" [rowHeight]="'auto'" [scrollbarH]="true"
                        [reorderable]="" [selectionType]="'checkbox'" [limit]="5" [selected]="item_selected_village"
                        [selectionType]="'single'" (select)="onSelectVillage($event)">
                        <ngx-datatable-column name="Code" prop="Code">
                            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value"
                                let-row="row">
                                <span *ngIf="!editing_village[rowIndex]">{{ value }}</span>
                                <input *ngIf="editing_village[rowIndex]" type="text"
                                    (change)="updateValueVillage($event, 'Code', rowIndex)" [value]="value" />
                            </ng-template>
                        </ngx-datatable-column>
                        <ngx-datatable-column name="Village" prop="Village">
                            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value"
                                let-row="row">
                                <span *ngIf="!editing_village[rowIndex]">{{ value }}</span>
                                <input *ngIf="editing_village[rowIndex]" type="text"
                                    (change)="updateValueVillage($event, 'Village', rowIndex)" [value]="value" />
                            </ng-template>
                        </ngx-datatable-column>
                        <ngx-datatable-column name="Vague" prop="vague">
                            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value"
                                let-row="row">
                                <span *ngIf="!editing_village[rowIndex]">{{ value }}</span>
                                <input *ngIf="editing_village[rowIndex]" type="text"
                                    (change)="updateValueVillage($event, 'vague', rowIndex)" [value]="value" />
                            </ng-template>
                        </ngx-datatable-column>
                        <ngx-datatable-column name="Zip" prop="zip.libelle">
                            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value"
                                let-row="row">
                                <span *ngIf="!editing_village[rowIndex]">{{ value }}</span>
                                <span *ngIf="editing_village[rowIndex]">
                                    <select matInput matNativeControl (selectionChange)="updateValue_select_zip($event, 'zip.id', rowIndex)" [(value)]="row.zip.libelle">
                                        <option *ngFor="let item of all_zip" 
                                            value={{item.id}}>
                                        {{item.libelle}}
                                        </option>
                                    </select> 
                                </span>
                            </ng-template>
                        </ngx-datatable-column>
                        <ngx-datatable-column name="Population RGPH 2017" prop="population_rgph_2017">
                            <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value"
                                let-row="row">
                                <span *ngIf="!editing_village[rowIndex]">{{ value }}</span>
                                <input *ngIf="editing_village[rowIndex]" type="text"
                                    (change)="updateValueVillage($event, 'population_rgph_2017', rowIndex)" [value]="value" />
                            </ng-template>
                        </ngx-datatable-column>
                    </ngx-datatable>
                </div>
                <!-- fin village -->
                <ng-template #suppressionDialogIle>
                    <h2 matDialogTitle>Etes-vous sûr de supprimer cet enregistrement ?</h2>
                    <mat-dialog-content>

                    </mat-dialog-content>
                    <mat-dialog-actions align="end">
                        <button mat-button matDialogClose style="color: red;"
                            (click)="suppressionConfirmerIle()">OUI</button>
                        <button mat-button matDialogClose (click)="AnnulerDialog()" color="primary">NON</button>
                    </mat-dialog-actions>
                </ng-template>

                <ng-template #suppressionDialogPrefecture>
                    <h2 matDialogTitle>Etes-vous sûr de supprimer cet enregistrement ?</h2>
                    <mat-dialog-content>

                    </mat-dialog-content>
                    <mat-dialog-actions align="end">
                        <button mat-button matDialogClose style="color: red;"
                            (click)="suppressionConfirmerPrefecture()">OUI</button>
                        <button mat-button matDialogClose (click)="AnnulerDialog()" color="primary">NON</button>
                    </mat-dialog-actions>
                </ng-template>

                <ng-template #suppressionDialogCommune>
                    <h2 matDialogTitle>Etes-vous sûr de supprimer cet enregistrement ?</h2>
                    <mat-dialog-content>

                    </mat-dialog-content>
                    <mat-dialog-actions align="end">
                        <button mat-button matDialogClose style="color: red;"
                            (click)="suppressionConfirmerCommune()">OUI</button>
                        <button mat-button matDialogClose (click)="AnnulerDialog()" color="primary">NON</button>
                    </mat-dialog-actions>
                </ng-template>

                <ng-template #suppressionDialogVillage>
                    <h2 matDialogTitle>Etes-vous sûr de supprimer cet enregistrement ?</h2>
                    <mat-dialog-content>

                    </mat-dialog-content>
                    <mat-dialog-actions align="end">
                        <button mat-button matDialogClose style="color: red;"
                            (click)="suppressionConfirmerVillage()">OUI</button>
                        <button mat-button matDialogClose (click)="AnnulerDialog()" color="primary">NON</button>
                    </mat-dialog-actions>
                </ng-template>
            </div>
        </div>
    </div>
    <div>